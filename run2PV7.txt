#!/bin/bash

#PBS -N xaf3test
#PBS -l select=1:ncpus=36:ngpus=1:mem=240gb
#PBS -l walltime=04:00:00
#PBS -q auto_free
#PBS -j oe

cd $PBS_O_WORKDIR/af3


export AF3_RESOURCES_DIR=/home/svu/sauyong/af3

export AF3_IMAGE=/app1/common/singularity-img/hopper/alphafold/alphafold301.sif
export AF3_CODE_DIR=${AF3_RESOURCES_DIR}/code
export AF3_INPUT_DIR=${AF3_RESOURCES_DIR}/examples/fold_2PV7
export AF3_OUTPUT_DIR=${AF3_RESOURCES_DIR}/examples/fold_2PV7
export AF3_MODEL_PARAMETERS_DIR=${AF3_RESOURCES_DIR}/weights
export AF3_DATABASES_DIR=/home/svu/alphafold/data3

singularity exec \
     --nv \
     --bind $AF3_INPUT_DIR:/root/af_input \
     --bind $AF3_OUTPUT_DIR:/root/af_output \
     --bind $AF3_MODEL_PARAMETERS_DIR:/root/models \
     --bind $AF3_DATABASES_DIR:/root/public_databases \
     $AF3_IMAGE \
     python ${AF3_CODE_DIR}/alphafold3/run_alphafold.py \
     --json_path=/root/af_input/alphafold_input.json \
     --model_dir=/root/models \
     --db_dir=/root/public_databases \
     --output_dir=/root/af_output
